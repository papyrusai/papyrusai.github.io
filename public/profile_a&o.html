<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
  />
  <title>Profile A&amp;O</title>
  <link rel="icon" href="assets/papyrus_logo.png" type="image/png">
  <link rel="stylesheet" type="text/css" href="styles/styles.css" />
  <link rel="stylesheet" type="text/css" href="styles/menu.css" />
  <link rel="stylesheet" type="text/css" href="styles/toggle.css" />
  <link rel="stylesheet" type="text/css" href="styles/dropdown.css" />
  <link rel="stylesheet" type="text/css" href="styles/radio_menu.css" />
  <link rel="stylesheet" type="text/css" href="styles/mobile.css" />

  <style>
    /* Additional styles for dropdowns */
    #serviciosDropdown,
    #tipoDropdown,
    #rangoDropdown {
      max-height: 200px;
      overflow-y: auto;
      position: absolute;
      z-index: 1000;
      background: #fff;
      border: 1px solid #ccc;
      padding: 5px;
    }
    #serviciosDropdown .dropdown-bottom,
    #tipoDropdown .dropdown-bottom,
    #rangoDropdown .dropdown-bottom {
      text-align: center;
      padding: 5px;
      border-top: 1px solid #ccc;
      cursor: pointer;
    }

    .dropdown {
      position: relative;
      display: inline-block;
    }

    /* Boletín Oficial: only BOE selectable (others are dimmed) */
    .filter-options input[type="checkbox"]:not([value="BOE"]) {
      opacity: 0.5;
      pointer-events: none;
    }

    .client-logo {
      height: 160px;
    }

    @media (max-width: 600px) {
      .client-logo {
        height: 120px;
      }
    }

    /* Multi-check styling: smaller font, border separator between each label */
    .dropdown-content label {
      display: block;
      padding: 4px 2px;
      margin: 0;
      cursor: pointer;
      font-size: 0.85em;
      border-bottom: 1px solid #ddd;
    }
    .dropdown-content label:last-child {
      border-bottom: none; /* no bottom border on last item */
    }

    /* Make checkboxes smaller + green accent color (#83a300) */
    .dropdown-content input[type="checkbox"] {
      width: 16px;
      height: 16px;
      transform: scale(0.9);
      accent-color: #83a300;
    }
  </style>
</head>

<body>
  <nav class="navbar">
    <div class="logo">
      <a href="https://www.papyrus-ai.com/" target="_blank">
        <img src="assets/papyrus_app.png" alt="Papyrus Logo" style="height: 55px;">
      </a>
    </div>
    <button class="hamburger" onclick="toggleMenu()">☰</button>
    <ul class="menu">
      <li><a href="https://papyrus-ai.com/">WEB</a></li>
      <li><a href="/profile_a&o">PANEL DE CONTROL</a></li>
      <li><a href="http://app.papyrus-ai.com/suscripcion.html">EDITAR SUSCRIPCIÓN</a></li>
      <li><a href="https://papyrus-ai.com/pages/contact-1">AYUDA</a></li>
    </ul>
  </nav>

  <!-- Profile Header with A&O logo -->
  <div class="profile-header" style="display: flex; align-items: center; gap: 15px; margin: 20px;">
    <img class="client-logo" src="assets/a&o_logo.png" alt="A&amp;O Logo">
  </div>

  <h1>Resumen diario Boletines Oficiales</h1>
  <div id="data-container">
    <!-- Filter Section -->
    <div id="Filtrar">
      <!-- INDUSTRIAS / Servicios A&O -->
      <div class="filter-item">
        <div class="etiquetas-label">Industrias A&amp;O Shearman</div>
        <div class="dropdown" style="margin-bottom: 10px;">
          <button onclick="toggleServiciosDropdown()" class="dropbtn">
            <span id="selectedServicio">Todos</span>
            <i class="fa fa-caret-down"></i>
          </button>

          <!-- MULTI-CHECK DROPDOWN for INDUSTRIES -->
          <div id="serviciosDropdown" class="dropdown-content">
            <!-- "Todos" is a special checkbox that toggles all. -->
            <label>
              <input type="checkbox" value="Todos" id="chkTodos" onclick="toggleAllIndustries()"> 
              Todos
            </label>
            <label><input type="checkbox" value="Chemicals" onclick="updateSelectedIndustries()">Chemicals</label>
            <label><input type="checkbox" value="Consumer and retail" onclick="updateSelectedIndustries()">Consumer and retail</label>
            <label><input type="checkbox" value="Communications, media and entertainment - Sports" onclick="updateSelectedIndustries()">Communications, media and entertainment - Sports</label>
            <label><input type="checkbox" value="Communications, media and entertainment - Media" onclick="updateSelectedIndustries()">Communications, media and entertainment - Media</label>
            <label><input type="checkbox" value="Communications, media and entertainment - Telecommunications" onclick="updateSelectedIndustries()">Communications, media and entertainment - Telecommunications</label>
            <label><input type="checkbox" value="Energy - Oil and gas" onclick="updateSelectedIndustries()">Energy - Oil and gas</label>
            <label><input type="checkbox" value="Energy - Hydrogen" onclick="updateSelectedIndustries()">Energy - Hydrogen</label>
            <label><input type="checkbox" value="Energy - Carbon capture and storage" onclick="updateSelectedIndustries()">Energy - Carbon capture and storage</label>
            <label><input type="checkbox" value="Energy - Power" onclick="updateSelectedIndustries()">Energy - Power</label>
            <label><input type="checkbox" value="Energy - Energy networks" onclick="updateSelectedIndustries()">Energy - Energy networks</label>
            <label><input type="checkbox" value="Energy - Nuclear" onclick="updateSelectedIndustries()">Energy - Nuclear</label>
            <label><input type="checkbox" value="Financial institutions - Banks" onclick="updateSelectedIndustries()">Financial institutions - Banks</label>
            <label><input type="checkbox" value="Financial institutions - Insurance" onclick="updateSelectedIndustries()">Financial institutions - Insurance</label>
            <label><input type="checkbox" value="Financial institutions - Fintech" onclick="updateSelectedIndustries()">Financial institutions - Fintech</label>
            <label><input type="checkbox" value="Industrials and manufacturing - Automotive" onclick="updateSelectedIndustries()">Industrials and manufacturing - Automotive</label>
            <label><input type="checkbox" value="Industrials and manufacturing - Aerospace and defense" onclick="updateSelectedIndustries()">Industrials and manufacturing - Aerospace and defense</label>
            <label><input type="checkbox" value="Infrastructure and transport - Aviation" onclick="updateSelectedIndustries()">Infrastructure and transport - Aviation</label>
            <label><input type="checkbox" value="Infrastructure and transport - Digital infrastructure" onclick="updateSelectedIndustries()">Infrastructure and transport - Digital infrastructure</label>
            <label><input type="checkbox" value="Life sciences and healthcare" onclick="updateSelectedIndustries()">Life sciences and healthcare</label>
            <label><input type="checkbox" value="Mining and metals" onclick="updateSelectedIndustries()">Mining and metals</label>
            <label><input type="checkbox" value="Private capital - Family office" onclick="updateSelectedIndustries()">Private capital - Family office</label>
            <label><input type="checkbox" value="Private capital - Infrastructure funds" onclick="updateSelectedIndustries()">Private capital - Infrastructure funds</label>
            <label><input type="checkbox" value="Private capital - Private credit" onclick="updateSelectedIndustries()">Private capital - Private credit</label>
            <label><input type="checkbox" value="Private capital - Private equity" onclick="updateSelectedIndustries()">Private capital - Private equity</label>
            <label><input type="checkbox" value="Private capital - Sovereign wealth and institutional investors" onclick="updateSelectedIndustries()">Private capital - Sovereign wealth and institutional investors</label>
            <label><input type="checkbox" value="Capital solutions" onclick="updateSelectedIndustries()">Capital solutions</label>
            <label><input type="checkbox" value="Technology" onclick="updateSelectedIndustries()">Technology</label>

            <!-- close dropdown button -->
            <div class="dropdown-bottom" onclick="toggleServiciosDropdown()">
              <i class="fa fa-caret-down"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- TIPO DISPOSICIÓN (Multi-Select) -->
      <div class="filter-item">
        <div class="etiquetas-label">Tipo disposición</div>
        <div class="dropdown" style="margin-bottom: 10px;">
          <button onclick="toggleTipoDropdown()" class="dropbtn">
            <span id="selectedTipo">Todos</span>
            <i class="fa fa-caret-down"></i>
          </button>
          <div id="tipoDropdown" class="dropdown-content">
            <!-- "Todos" for Tipo -->
            <label>
              <input type="checkbox" value="Todos" id="chkTodosTipo" onclick="toggleAllTipo()">
              Todos
            </label>
            <label><input type="checkbox" value="Disposiciones generales" onclick="updateSelectedTipo()">Disposiciones generales</label>
            <label><input type="checkbox" value="Otras disposiciones" onclick="updateSelectedTipo()">Otras disposiciones</label>

            <div class="dropdown-bottom" onclick="toggleTipoDropdown()">
              <i class="fa fa-caret-down"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- RANGO (Multi-Select) -->
      <div class="filter-item">
        <div class="etiquetas-label">Rango</div>
        <div class="dropdown" style="margin-bottom: 10px;">
          <button onclick="toggleRangoDropdown()" class="dropbtn">
            <span id="selectedRango">Todos</span>
            <i class="fa fa-caret-down"></i>
          </button>
          <div id="rangoDropdown" class="dropdown-content">
            <!-- "Todos" for Rango -->
            <label>
              <input type="checkbox" value="Todos" id="chkTodosRango" onclick="toggleAllRango()">
              Todos
            </label>
            <label><input type="checkbox" value="Leyes" onclick="updateSelectedRango()">Leyes</label>
            <label><input type="checkbox" value="Reglamentos" onclick="updateSelectedRango()">Reglamentos</label>
            <label><input type="checkbox" value="Decisiones interpretativas y Reguladores" onclick="updateSelectedRango()">Decisiones interpretativas y Reguladores</label>
            <label><input type="checkbox" value="Jurisprudencia" onclick="updateSelectedRango()">Jurisprudencia</label>
            <label><input type="checkbox" value="Ayudas,subvenciones y premios" onclick="updateSelectedRango()">Ayudas,subvenciones y premios</label>
            <label><input type="checkbox" value="Otras" onclick="updateSelectedRango()">Otras</label>

            <div class="dropdown-bottom" onclick="toggleRangoDropdown()">
              <i class="fa fa-caret-down"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Boletín Oficial (only BOE is selectable) -->
      <div class="filter-item">
        <div class="filter-section">
          <div class="etiquetas-label">Boletín Oficial</div>
          <div class="filter-options">
            <label class="filter-option">
              <input type="checkbox" name="boletin" value="BOE" checked> BOE
            </label>
            <label class="filter-option">
              <input type="checkbox" name="boletin" value="BOCM" disabled> BOCM
            </label>
            <label class="filter-option">
              <input type="checkbox" name="boletin" value="BOA" disabled> BOA
            </label>
            <label class="filter-option">
              <input type="checkbox" name="boletin" value="BOJA" disabled> BOJA
            </label>
            <label class="filter-option">
              <input type="checkbox" name="boletin" value="BOPV" disabled> BOPV
            </label>
            <label class="filter-option">
              <input type="checkbox" name="boletin" value="DOUE" disabled> DOUE
            </label>
          </div>
        </div>
      </div>
    </div>

    <div style="text-align: right;">
      <button id="buscarBtn" onclick="handleBuscar_ao()">Buscar</button>
    </div>

    <!-- Documentos Section -->
    <div class="analytics-label">Documentos - Día {{documentDate}}</div>
    <div class="collectionDocs">
      {{boeDocuments}}
    </div>
  </div>

  <div class="logout-container">
    <a href="/logout">Logout</a>
  </div>

  <script>
    // -------------- Menu toggling --------------
    function toggleMenu() {
      const menu = document.querySelector('.menu');
      menu.classList.toggle('active');
    }

    // On click anywhere else, close dropdowns & menu
    document.addEventListener('click', function(event) {
      const serviciosDropdown = document.getElementById('serviciosDropdown');
      if (serviciosDropdown && serviciosDropdown.classList.contains('show')
          && !event.target.closest('.dropdown')) {
        serviciosDropdown.classList.remove('show');
      }

      const tipoDropdown = document.getElementById('tipoDropdown');
      if (tipoDropdown && tipoDropdown.classList.contains('show')
          && !event.target.closest('.dropdown')) {
        tipoDropdown.classList.remove('show');
      }

      const rangoDropdown = document.getElementById('rangoDropdown');
      if (rangoDropdown && rangoDropdown.classList.contains('show')
          && !event.target.closest('.dropdown')) {
        rangoDropdown.classList.remove('show');
      }

      const menu = document.querySelector('.menu');
      const hamburger = document.querySelector('.hamburger');
      if (!menu.contains(event.target) && !hamburger.contains(event.target)) {
        menu.classList.remove('active');
      }
    });

    // -------------- Dropdown Toggles --------------
    function toggleServiciosDropdown() {
      const dropdown = document.getElementById('serviciosDropdown');
      dropdown.classList.toggle('show');
    }
    function toggleTipoDropdown() {
      const dropdown = document.getElementById('tipoDropdown');
      dropdown.classList.toggle('show');
    }
    function toggleRangoDropdown() {
      const dropdown = document.getElementById('rangoDropdown');
      dropdown.classList.toggle('show');
    }

    // -------------- Multi-Select Logic: Industrias --------------
    function updateSelectedIndustries() {
      const checkboxes = document.querySelectorAll('#serviciosDropdown input[type="checkbox"]:not(#chkTodos)');
      const chkTodos = document.getElementById('chkTodos');
      let selectedCount = 0;
      let totalCount = 0;
      let singleSelectedValue = "";

      checkboxes.forEach(cb => {
        totalCount++;
        if (cb.checked) {
          selectedCount++;
          singleSelectedValue = cb.value;
        }
      });

      if (selectedCount === totalCount) {
        chkTodos.checked = true;
      } else {
        chkTodos.checked = false;
      }

      const buttonLabel = document.getElementById('selectedServicio');
      if (selectedCount === 0) {
        buttonLabel.textContent = "Ninguno";
      } else if (selectedCount === totalCount) {
        buttonLabel.textContent = "Todos";
      } else if (selectedCount === 1) {
        buttonLabel.textContent = singleSelectedValue;
      } else {
        buttonLabel.textContent = selectedCount + " seleccionados";
      }
    }
    function toggleAllIndustries() {
      const chkTodos = document.getElementById('chkTodos');
      const checkboxes = document.querySelectorAll('#serviciosDropdown input[type="checkbox"]:not(#chkTodos)');
      if (chkTodos.checked) {
        checkboxes.forEach(cb => (cb.checked = true));
      } else {
        checkboxes.forEach(cb => (cb.checked = false));
      }
      updateSelectedIndustries();
    }

    // -------------- Multi-Select Logic: TIPO DISPOSICIÓN --------------
    function updateSelectedTipo() {
      const checkboxes = document.querySelectorAll('#tipoDropdown input[type="checkbox"]:not(#chkTodosTipo)');
      const chkTodosTipo = document.getElementById('chkTodosTipo');
      let selectedCount = 0;
      let totalCount = 0;
      let singleValue = "";

      checkboxes.forEach(cb => {
        totalCount++;
        if (cb.checked) {
          selectedCount++;
          singleValue = cb.value;
        }
      });

      if (selectedCount === totalCount) {
        chkTodosTipo.checked = true;
      } else {
        chkTodosTipo.checked = false;
      }

      const tipoLabel = document.getElementById('selectedTipo');
      if (selectedCount === 0) {
        tipoLabel.textContent = "Ninguno";
      } else if (selectedCount === totalCount) {
        tipoLabel.textContent = "Todos";
      } else if (selectedCount === 1) {
        tipoLabel.textContent = singleValue;
      } else {
        tipoLabel.textContent = selectedCount + " seleccionados";
      }
    }
    function toggleAllTipo() {
      const chkTodosTipo = document.getElementById('chkTodosTipo');
      const checkboxes = document.querySelectorAll('#tipoDropdown input[type="checkbox"]:not(#chkTodosTipo)');
      if (chkTodosTipo.checked) {
        checkboxes.forEach(cb => (cb.checked = true));
      } else {
        checkboxes.forEach(cb => (cb.checked = false));
      }
      updateSelectedTipo();
    }

    // -------------- Multi-Select Logic: RANGO --------------
    function updateSelectedRango() {
      const checkboxes = document.querySelectorAll('#rangoDropdown input[type="checkbox"]:not(#chkTodosRango)');
      const chkTodosRango = document.getElementById('chkTodosRango');
      let selectedCount = 0;
      let totalCount = 0;
      let singleVal = "";

      checkboxes.forEach(cb => {
        totalCount++;
        if (cb.checked) {
          selectedCount++;
          singleVal = cb.value;
        }
      });

      if (selectedCount === totalCount) {
        chkTodosRango.checked = true;
      } else {
        chkTodosRango.checked = false;
      }

      const rangoLabel = document.getElementById('selectedRango');
      if (selectedCount === 0) {
        rangoLabel.textContent = "Ninguno";
      } else if (selectedCount === totalCount) {
        rangoLabel.textContent = "Todos";
      } else if (selectedCount === 1) {
        rangoLabel.textContent = singleVal;
      } else {
        rangoLabel.textContent = selectedCount + " seleccionados";
      }
    }
    function toggleAllRango() {
      const chkTodosRango = document.getElementById('chkTodosRango');
      const checkboxes = document.querySelectorAll('#rangoDropdown input[type="checkbox"]:not(#chkTodosRango)');
      if (chkTodosRango.checked) {
        checkboxes.forEach(cb => (cb.checked = true));
      } else {
        checkboxes.forEach(cb => (cb.checked = false));
      }
      updateSelectedRango();
    }

    // -------------- "Buscar" Filter Logic --------------
    function handleBuscar_ao() {
      // 1) Gather selected industries
      const industryCbs = document.querySelectorAll('#serviciosDropdown input[type="checkbox"]:not(#chkTodos)');
      let selectedIndustries = [];
      industryCbs.forEach(cb => {
        if (cb.checked) {
          selectedIndustries.push(cb.value);
        }
      });

      // 2) Gather selected TIPO
      const tipoCbs = document.querySelectorAll('#tipoDropdown input[type="checkbox"]:not(#chkTodosTipo)');
      let selectedTipos = [];
      tipoCbs.forEach(cb => {
        if (cb.checked) {
          selectedTipos.push(cb.value);
        }
      });

      // 3) Gather selected RANGO
      const rangoCbs = document.querySelectorAll('#rangoDropdown input[type="checkbox"]:not(#chkTodosRango)');
      let selectedRangos = [];
      rangoCbs.forEach(cb => {
        if (cb.checked) {
          selectedRangos.push(cb.value);
        }
      });

      // All document items
      const docs = document.querySelectorAll('.collectionDocs .data-item');
      docs.forEach(doc => {
        const etiquetasText = doc.querySelector('.etiquetas-values').innerText;
        const seccionText = doc.querySelector('.doc-seccion')
                          ? doc.querySelector('.doc-seccion').innerText
                          : "";
        const rangoText = doc.querySelector('.doc-rango')
                          ? doc.querySelector('.doc-rango').innerText
                          : "";

        // ----- Industry match -----
        let matchIndustria = false;
        if (selectedIndustries.length === 0) {
          matchIndustria = false;
        } else {
          for (let ind of selectedIndustries) {
            if (etiquetasText.includes(ind)) {
              matchIndustria = true;
              break;
            }
          }
        }

        // ----- Tipo match -----
        let matchTipo = false;
        if (selectedTipos.length === 0) {
          matchTipo = false;
        } else {
          for (let t of selectedTipos) {
            if (seccionText.includes(t)) {
              matchTipo = true;
              break;
            }
          }
        }

        // ----- Rango match -----
        let matchRango = false;
        if (selectedRangos.length === 0) {
          matchRango = false;
        } else {
          for (let r of selectedRangos) {
            if (rangoText.includes(r)) {
              matchRango = true;
              break;
            }
          }
        }

        // Only show if all three are matched
        if (matchIndustria && matchTipo && matchRango) {
          doc.style.display = '';
        } else {
          doc.style.display = 'none';
        }
      });
    }
  </script>
</body>
</html>
