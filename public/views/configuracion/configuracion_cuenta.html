<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configuración de Cuenta</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    /* Configuration specific styles with higher specificity */
    #configuracion-iframe-container {
      --primary-color: #04db8d;
      --text-color: #455862;
      --dark-color: #0b2431;
    }

    #configuracion-iframe-container .config-body {
      margin: 0;
      padding: 20px;
      font-family: 'Satoshi', sans-serif;
    }
    
    #configuracion-iframe-container .config-menu {
      display: flex !important;
      justify-content: center;
      align-items: center;
      gap: 40px;
      padding-bottom: 20px;
      flex-direction: row !important;
    }
    
    #configuracion-iframe-container .config-menu-item {
      display: flex !important;
      align-items: center;
      gap: 8px;
      color: var(--text-color);
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: color 0.3s ease;
      user-select: none;
      text-decoration: none;
    }
    
    #configuracion-iframe-container .config-menu-item:hover {
      color: var(--dark-color);
    }
    
    #configuracion-iframe-container .config-menu-item.active {
      color: var(--primary-color) !important;
      border-bottom: 2px solid var(--primary-color) !important;
      padding-bottom: 8px !important;
    }
    
    #configuracion-iframe-container .config-menu-item i {
      font-size: 18px;
    }
    
    #configuracion-iframe-container .config-content {
      display: none !important;
      padding: 40px;
      background: white;
      border-radius: 8px;
      text-align: center;
      min-height: 300px;
      justify-content: center;
      flex-direction: column;
    }
    
    #configuracion-iframe-container .config-content.active {
      display: flex !important;
    }
    
    #configuracion-iframe-container .content-text {
      font-size: 24px;
      color: var(--text-color);
      font-weight: 500;
    }

    #configuracion-iframe-container .content-title {
      font-size: 20px;
      color: var(--dark-color);
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
      line-height: 1.4;
    }

    /* ---------- Onboarding form styles (scoped) ---------- */
    #configuracion-iframe-container #onboarding-container {
      width: 100%;
      max-width: 660px;
    }
    #configuracion-iframe-container #summary-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 30px;
    }
    #configuracion-iframe-container .summary-tag {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--primary-color);
      color: #fff;
      border-radius: 20px;
      padding: 6px 14px;
      font-size: 14px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
      cursor: pointer;
    }
    #configuracion-iframe-container .summary-tag .tick { font-weight: 700; }
    #configuracion-iframe-container .form-step { display:none; }
    #configuracion-iframe-container .form-step.active { display:block; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
    #configuracion-iframe-container .step-header { display:flex; justify-content:space-between; align-items:baseline; margin-bottom:16px; }
    #configuracion-iframe-container .question-text { font-size:20px; font-weight:700; }
    #configuracion-iframe-container .step-tracker { font-size:14px; color: var(--secondary-color); }
    #configuracion-iframe-container .options { display:flex; flex-wrap:wrap; gap:12px; }
    #configuracion-iframe-container .option-box {
      flex: 1 1 calc(50% - 12px);
      background: transparent;
      border: 2px solid var(--border-color, #e0e0e0);
      border-radius: 12px;
      padding: 14px 18px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
      color: var(--text-color);
      min-width: 120px;
    }
    #configuracion-iframe-container .option-box:hover { border-color: var(--primary-color); background: rgba(4,219,141,0.08); }
    #configuracion-iframe-container .option-box.selected { background: var(--primary-color); border-color: var(--primary-color); color:#fff; }
    #configuracion-iframe-container #completion-message { text-align:center; font-size:22px; font-weight:600; }



    /* ---------- NEW STYLES ---------- */
    #configuracion-iframe-container .main-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 28px;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 8px;
      background: linear-gradient(90deg, var(--dark-color), var(--primary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: left;
    }
    #configuracion-iframe-container .main-title i {
      font-size: 26px;
      color: var(--text-color);
    }
    /* Content title consistent styling */
    #configuracion-iframe-container .content-title {
      font-size: 16px;
      color: #7a8a93;
      margin-bottom: 24px;
      text-align: left;
    }
    /* Reduce top padding so title sits closer to the menu */
    #configuracion-iframe-container .config-content {
      padding-top: 30px;
    }
    /* Option box elevation style */
    #configuracion-iframe-container .option-box {
      border: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }
    #configuracion-iframe-container .option-box:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.12);
      transform: translateY(-2px);
    }
    #configuracion-iframe-container .option-box.selected {
      border: 1px solid var(--text-color);
      box-shadow: 0 4px 12px rgba(69,88,98,0.4);
      color: var(--text-color) !important;
      background:none;
    }

    /* Generic input style for onboarding */
    #configuracion-iframe-container .input-field {
      width: 100%;
      max-width: 420px;
      padding: 12px 16px;
      font-size: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      transition: border-color 0.2s ease;
    }
    #configuracion-iframe-container .input-field:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 2px rgba(4,219,141,0.15);
    }

    #configuracion-iframe-container .save-btn {
      margin-top: 18px;
      background: var(--primary-color);
      color: #fff;
      border: none;
      padding: 10px 24px;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.25s ease;
    }
    #configuracion-iframe-container .save-btn:hover {
      background:#03c77d;
    }

    /* Web empresa button with gradient style */
    #configuracion-iframe-container .web-empresa-btn {
      background: linear-gradient(90deg, var(--dark-color), var(--primary-color)) !important;
      color: white !important;
      border: none !important;
      border-radius: 10px !important;
      padding: 12px 24px !important;
      font-size: 16px !important;
      font-weight: 600 !important;
      cursor: pointer;
      transition: all 0.3s ease !important;
      margin: 20px auto 0 auto !important;
      display: flex !important;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(69,88,98,0.3) !important;
      width: fit-content;
    }
    #configuracion-iframe-container .web-empresa-btn:hover {
      background: linear-gradient(90deg, var(--dark-color), var(--primary-color)) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 6px 16px rgba(69,88,98,0.4) !important;
    }

    /* Custom input container when user selects 'Otro' */
    #configuracion-iframe-container .custom-input-container{
      width:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:14px;
      margin-top:24px;
    }
    #configuracion-iframe-container .next-btn{
      background:var(--dark-color);
      color:#fff;
      border:none;
      padding:10px 40px;
      border-radius:8px;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      transition:background .25s ease;
    }
    #configuracion-iframe-container .next-btn:hover{background:#03c77d;}

    /* Custom tags inside custom input */
    #configuracion-iframe-container .custom-tags-wrap{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      width:100%;
    }
    #configuracion-iframe-container .custom-tag{
      background:#e5e5e5;
      color:var(--dark-color);
      border-radius:14px;
      padding:4px 10px;
      font-size:13px;
      display:flex;
      align-items:center;
    }
    #configuracion-iframe-container .custom-tag .remove-tag{
      margin-left:6px;
      cursor:pointer;
      font-weight:700;
      line-height:1;
    }

    /* Loader overlay */
    #configuracion-iframe-container #config-loader{
      position:absolute;
      inset:0;
      background:white;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:2000;
    }
    #configuracion-iframe-container .spinner{
      width:40px;
      height:40px;
      border:4px solid #f3f3f3;
      border-top:4px solid var(--primary-color);
      border-radius:50%;
      animation:spin 1s linear infinite;
    }
    @keyframes spin{ to{transform:rotate(360deg);} }

    /* Styles for the final summary view */
    #configuracion-iframe-container #profile-summary-view {
      animation: fadeIn 0.5s ease-in-out;
    }
    #configuracion-iframe-container .summary-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--dark-color);
      margin-top: 30px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }
    #configuracion-iframe-container .summary-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    #configuracion-iframe-container .summary-table td {
      padding: 12px 8px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 15px;
      color: var(--text-color);
    }
    #configuracion-iframe-container .summary-table td:first-child {
      font-weight: 500;
      width: 30%;
      color: var(--dark-color);
    }
    #configuracion-iframe-container .regulatory-summary {
      font-size: 15px;
      line-height: 1.7;
      color: var(--text-color);
    }
    #configuracion-iframe-container .regulatory-summary p {
      margin-bottom: 1em;
      font-weight: normal !important;
      text-align: left !important;
    }
    /* Animation for transition */
    @keyframes slideUpAndFadeOut {
      to {
        opacity: 0;
        transform: translateY(-20px);
      }
    }
    #configuracion-iframe-container .fading-out {
      animation: slideUpAndFadeOut 0.4s forwards;
    }

    /* --- Fuentes Section Carousel --- */
    #configuracion-iframe-container .fuentes-subsection {
        margin-top: 20px;
    }
    #configuracion-iframe-container .fuentes-subsection-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 15px;
        border-bottom: 1px solid #f0f0f0;
        padding-bottom: 8px;
    }
    #configuracion-iframe-container .fuentes-grid-container {
        position: relative;
        padding: 0 40px; /* space for arrows */
        min-height: 120px; /* to avoid layout shifts */
    }
    #configuracion-iframe-container .grid-nav-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: #f0f0f0;
        color: var(--text-color);
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        z-index: 10;
        user-select: none;
    }
    #configuracion-iframe-container .grid-nav-arrow:hover {
        background: #e0e0e0;
        transform: translateY(-50%) scale(1.1);
    }
    #configuracion-iframe-container .grid-nav-arrow.prev {
        left: 0;
    }
    #configuracion-iframe-container .grid-nav-arrow.next {
        right: 0;
    }
    #configuracion-iframe-container .grid-nav-arrow i {
      font-size: 14px;
    }

    /* --- Fuentes Section Styles --- */
    #configuracion-iframe-container .configura-cobertura-btn {
        display: none; /* Hidden by default */
        background: #e8f5e8;
        color: var(--dark-color);
        border: 1px solid var(--primary-color);
        border-radius: 8px;
        padding: 14px 20px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 20px 0;
        width: 100%;
        text-align: left;
    }
    #configuracion-iframe-container .configura-cobertura-btn:hover {
        background: #d8f0d8;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    #configuracion-iframe-container .configura-agentes-btn {
        display: none; /* Hidden by default */
        background: #e8f5e8;
        color: var(--dark-color);
        border: 1px solid var(--primary-color);
        border-radius: 8px;
        padding: 14px 20px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 20px 0;
        width: 100%;
        text-align: left;
    }
    #configuracion-iframe-container .configura-agentes-btn:hover {
        background: #d8f0d8;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    #configuracion-iframe-container .fuentes-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin-top: 10px;
        margin-bottom: 30px;
    }
    #configuracion-iframe-container .fuente-box {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        padding: 10px;
        text-align: left;
        cursor: pointer;
        transition: all 0.2s ease;
        max-height: 80px;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        overflow: hidden;
        position: relative;
    }
    #configuracion-iframe-container .fuente-box:hover {
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    #configuracion-iframe-container .fuente-box.selected {
        background: white;
        border-color: #dfe3e6;
        color: var(--dark-color);
        box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    }
    #configuracion-iframe-container .fuente-box .tick-badge {
        display: none;
        position: absolute;
        top: 8px;
        right: 8px;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #04db8d;
        color: #fff;
        font-size: 12px;
        line-height: 18px;
        text-align: center;
        box-shadow: 0 2px 6px rgba(4,219,141,0.35);
        pointer-events: none;
    }
    #configuracion-iframe-container .fuente-box.selected .tick-badge {
        display: inline-block;
    }
    #configuracion-iframe-container .fuente-box strong {
        font-size: 16px;
        margin-bottom: 5px;
        padding-bottom: 3px;
        border-bottom: 1px solid #e0e0e0;
        width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    #configuracion-iframe-container .fuente-box span {
        font-size: 12px;
        color: #7a8a93;
        line-height: 1.3;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        flex: 1;
    }
    #configuracion-iframe-container .fuente-box.selected strong {
        border-bottom-color: rgba(4, 219, 141, 0.1);
    }
         #configuracion-iframe-container .save-fuentes-btn-inline {
      background: var(--dark-color);
      color: white;
      border: none;
      border-radius: 20px;
      padding: 8px 20px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-left: auto;
    }
     #configuracion-iframe-container .save-fuentes-btn-inline:hover {
        background: #04db8d;
     }
     #configuracion-iframe-container .save-fuentes-btn-inline.success {
        background: #04db8d;
     }
     #configuracion-iframe-container .save-fuentes-btn-inline.loading {
        background: #6c757d;
        cursor: not-allowed;
     }
     #configuracion-iframe-container .button-spinner {
        width: 14px;
        height: 14px;
        border: 2px solid rgba(255,255,255,0.3);
        border-top: 2px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto;
     }
     #configuracion-iframe-container .save-status {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 5px;
        font-size: 12px;
        color: #dc3545;
        font-weight: 500;
     }
     
           /* Selected tags styles */
      #configuracion-iframe-container .section-header {
         display: flex;
         align-items: center;
         gap: 15px;
         margin-bottom: 15px;
         flex-wrap: wrap;
         position: relative;
      }
     #configuracion-iframe-container .selected-tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
     }
           #configuracion-iframe-container .selected-tag {
           
            padding: 4px 8px;
            border: 1px solid var(--text-color);
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-color);
      }
      
      /* Crear agente button styles */
      #configuracion-iframe-container .crear-agente-btn {
         background: linear-gradient(90deg, var(--dark-color), var(--primary-color));
         color: white;
         border: none;
         border-radius: 10px;
         padding: 10px 18px;
         font-size: 14px;
         font-weight: 600;
         cursor: pointer;
         transition: all 0.3s ease;
         margin-bottom: 20px;
         display: flex;
         align-items: center;
         gap: 6px;
         box-shadow: 0 4px 12px rgba(69,88,98,0.3);
         width: fit-content;
      }
      #configuracion-iframe-container .crear-agente-btn:hover {
         transform: translateY(-2px);
         box-shadow: 0 6px 16px rgba(69,88,98,0.4);
      }
             #configuracion-iframe-container .crear-agente-btn i {
          font-size: 12px;
       }

       /* Agent template selection box */
       #configuracion-iframe-container .agent-template-box {
          width: 100%;
          background: white;
          border-radius: 12px;
          padding: 25px;
          margin-top: 30px;
          box-shadow: 0 8px 24px rgba(0,0,0,0.12);
          animation: fadeInUp 0.3s ease-out;
          position: relative;
       }

       #configuracion-iframe-container .close-template-box {
          position: absolute;
          top: 15px;
          right: 15px;
          background: transparent;
          border: none;
          color: #999;
          font-size: 16px;
          cursor: pointer;
          width: 30px;
          height: 30px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          transition: all 0.2s ease;
       }

       #configuracion-iframe-container .close-template-box:hover {
          background: #f5f5f5;
          color: var(--dark-color);
       }

               #configuracion-iframe-container .template-title {
           font-size: 16px;
           font-weight: 600;
           color: var(--dark-color);
           margin-bottom: 20px;
           text-align: center;
           line-height: 1.4;
           padding-right: 40px;
        }

        /* Override text alignment for product details form */
        #configuracion-iframe-container .product-details-form .template-title {
           text-align: left;
        }

       #configuracion-iframe-container .template-options {
          display: flex;
          flex-direction: column;
          gap: 12px;
       }

       #configuracion-iframe-container .template-btn {
          width: 100%;
          background: transparent;
          border: 2px solid var(--text-color);
          border-radius: 10px;
          padding: 16px 18px;
          color: var(--text-color);
          cursor: pointer;
          transition: all 0.3s ease;
          text-align: left;
       }

       #configuracion-iframe-container .template-btn:hover {
          border-color: var(--primary-color);
          color: var(--primary-color);
          transform: translateY(-1px);
          box-shadow: 0 3px 8px rgba(4,219,141,0.2);
       }

       #configuracion-iframe-container .template-btn-content {
          width: 100%;
       }

       #configuracion-iframe-container .template-btn-header {
          display: flex;
          align-items: center;
          gap: 10px;
          margin-bottom: 8px;
       }

       #configuracion-iframe-container .template-btn-header i {
          font-size: 16px;
          width: 20px;
          text-align: center;
       }

       #configuracion-iframe-container .template-btn-title {
          font-size: 14px;
          font-weight: 600;
       }

       #configuracion-iframe-container .template-btn-description {
          font-size: 12px;
          color: #7a8a93;
          line-height: 1.4;
          margin: 0;
          text-align: left;
       }

       #configuracion-iframe-container .template-btn-description em {
          font-style: italic;
          color: #999;
       }

       #configuracion-iframe-container .template-btn:hover .template-btn-description {
          color: #7a8a93;
       }

               @keyframes fadeInUp {
           from {
               opacity: 0;
               transform: translateY(20px);
           }
           to {
               opacity: 1;
               transform: translateY(0);
           }
        }

        /* Product details form styles */
        #configuracion-iframe-container .product-details-form {
           width: 100%;
           background: white;
           border-radius: 12px;
           padding: 25px;
           margin-top: 30px;
           box-shadow: 0 8px 24px rgba(0,0,0,0.12);
           animation: fadeInUp 0.3s ease-out;
           position: relative;
        }

        #configuracion-iframe-container .product-form-fields {
           margin-bottom: 30px;
        }

        #configuracion-iframe-container .form-field {
           margin-bottom: 20px;
        }

        #configuracion-iframe-container .field-label {
           display: block;
           font-size: 14px;
           font-weight: 700;
           color: var(--dark-color);
           margin-bottom: 8px;
           line-height: 1.4;
           text-align: left;
        }

        #configuracion-iframe-container .field-label-with-info {
          display: flex;
          align-items: center;
          gap: 8px;
        }
        #configuracion-iframe-container .info-icon {
           width: 16px;
           height: 16px;
           border-radius: 50%;
           background: rgba(11,36,49,0.9);
           color: white;
           display: inline-flex;
           align-items: center;
           justify-content: center;
           font-size: 10px;
           font-weight: 600;
           cursor: pointer;
           position: relative;
           transition: all 0.2s ease;
           margin-bottom: 5px;
         }
        #configuracion-iframe-container .info-icon:hover::after {
           content: attr(data-tooltip);
           position: absolute;
           bottom: 120%;
           left: 0;
           background: var(--dark-color);
           color: white;
           padding: 8px 12px;
           border-radius: 6px;
           font-size: 12px;
           line-height: 1.4;
           white-space: normal;
           z-index: 1000;
           box-shadow: 0 4px 12px rgba(0,0,0,0.2);
           width: 300px;
           min-height: 100px;
         }
        #configuracion-iframe-container .info-icon:hover::before {
          content: '';
          position: absolute;
          bottom: 110%;
          left: 8px;
          width: 0;
          height: 0;
          border-left: 5px solid transparent;
          border-right: 5px solid transparent;
          border-top: 5px solid var(--dark-color);
        }

        #configuracion-iframe-container .product-input,
         #configuracion-iframe-container .product-select {
            width: 100%;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 15px;
            color: var(--text-color);
            transition: border-color 0.3s ease;
            background: white;
            resize: vertical;
         }

        #configuracion-iframe-container .product-input:focus,
        #configuracion-iframe-container .product-select:focus {
           border-color: var(--primary-color);
           outline: none;
           box-shadow: 0 0 0 2px rgba(4,219,141,0.15);
        }

        #configuracion-iframe-container .product-input::placeholder {
           color: #999;
           font-style: normal;
        }

        #configuracion-iframe-container .product-select {
           cursor: pointer;
        }

        #configuracion-iframe-container .generate-agent-container {
           display: flex;
           justify-content: center;
           margin-top: 30px;
        }

        #configuracion-iframe-container .generate-agent-btn {
           background: linear-gradient(90deg, var(--dark-color), var(--primary-color));
           color: white;
           border: none;
           border-radius: 12px;
           padding: 16px 32px;
           font-size: 16px;
           font-weight: 600;
           cursor: pointer;
           transition: all 0.3s ease;
           display: flex;
           align-items: center;
           gap: 10px;
           box-shadow: 0 4px 12px rgba(69,88,98,0.3);
        }

        #configuracion-iframe-container .generate-agent-btn:hover {
           transform: translateY(-2px);
           box-shadow: 0 6px 16px rgba(69,88,98,0.4);
        }

                #configuracion-iframe-container .generate-agent-btn i {
            font-size: 16px;
         }

         #configuracion-iframe-container .custom-input-container {
            margin-top: 10px;
            animation: fadeIn 0.3s ease-out;
         }

         @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
         }

         /* Generated agent display styles */
         #configuracion-iframe-container .generated-agent-box {
            background: white;
            border: 1px solid var(--dark-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 4px 12px rgba(4,219,141,0.15);
            animation: fadeInUp 0.4s ease-out;
            text-align: left;
         }

         #configuracion-iframe-container .generated-agent-content {
            padding-right: 35px;
            text-align: left;
         }

         #configuracion-iframe-container .agent-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark-color);
            margin: 0 0 8px 0;
            line-height: 1.3;
            text-align: left;
         }

         #configuracion-iframe-container .agent-definition {
            font-size: 13px;
            color: var(--text-color);
            line-height: 1.4;
            margin: 0;
            text-align: left;
         }

         #configuracion-iframe-container .close-agent-box {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: #495057;
            font-size: 12px;
            cursor: pointer;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
         }

         #configuracion-iframe-container .close-agent-box:hover {
            background: #f5f5f5;
            color: #c82333;
            transform: scale(1.1);
         }

         /* Agent editing styles */
         #configuracion-iframe-container .agent-edit-controls {
            position: absolute;
            top: 15px;
            right: 45px;
            display: flex;
            align-items: center;
            gap: 8px;
         }

         #configuracion-iframe-container .edit-agent-btn,
         #configuracion-iframe-container .save-agent-btn,
         #configuracion-iframe-container .cancel-agent-btn {
            background: transparent;
            border: none;
            color: #333;
            font-size: 12px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
         }

         #configuracion-iframe-container .edit-agent-btn:hover,
         #configuracion-iframe-container .save-agent-btn:hover,
         #configuracion-iframe-container .cancel-agent-btn:hover {
            background: #f5f5f5;
         }

         #configuracion-iframe-container .save-agent-btn {
            color: var(--primary-color);
         }

         #configuracion-iframe-container .save-agent-btn:disabled {
            color: #999;
            cursor: not-allowed;
            opacity: 0.7;
         }

         #configuracion-iframe-container .cancel-agent-btn {
            color: #dc3545;
         }

         #configuracion-iframe-container .agent-name-edit,
         #configuracion-iframe-container .agent-definition-edit {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px 8px;
            font-family: inherit;
            resize: vertical;
            box-sizing: border-box;
         }

         #configuracion-iframe-container .agent-name-edit {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
         }

         #configuracion-iframe-container .agent-definition-edit {
            font-size: 13px;
            min-height: 60px;
         }

         /* Ensure the generated agent box maintains width during editing */
         #configuracion-iframe-container .generated-agent-box {
            min-width: 400px;
            width: 100%;
            max-width: 800px;
            transition: min-height 0.5s ease, padding 0.5s ease, margin-bottom 0.5s ease;
         }

         #configuracion-iframe-container .generated-agent-content {
            width: 100%;
            box-sizing: border-box;
         }

         /* Expanded state for editing */
         #configuracion-iframe-container .generated-agent-box.editing {
            min-height: 200px;
            padding-bottom: 25px;
            margin-bottom: 25px;
         }

         #configuracion-iframe-container .generated-agent-box.editing .generated-agent-content {
            padding-top: 30px;
         }

         #configuracion-iframe-container .generated-agent-box.editing .agent-definition-edit {
            min-height: 120px;
         }

         /* Character counter styles */
         #configuracion-iframe-container .character-counter-container {
            position: relative;
            margin-top: 8px;
         }

         #configuracion-iframe-container .character-counter {
            font-size: 12px;
            color: #7a8a93;
            text-align: left;
            transition: color 0.3s ease;
         }

         #configuracion-iframe-container .character-counter.over-limit {
            color: #dc3545;
            font-weight: 600;
         }

         #configuracion-iframe-container .character-error-message {
            color: #dc3545;
            font-size: 12px;
            font-weight: 600;
            margin-right: 10px;
         }

         /* Edit context styles */
         #configuracion-iframe-container .context-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
         }

         #configuracion-iframe-container .edit-context-btn {
            background: transparent;
            border: none;
            color: var(--dark-color);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s ease;
         }

         #configuracion-iframe-container .edit-context-btn:hover {
            background: rgba(69,88,98,0.1);
         }

         #configuracion-iframe-container .edit-context-controls {
            display: flex;
            gap: 10px;
         }

         #configuracion-iframe-container .cancel-edit-btn {
            background: transparent;
            border: 1px solid var(--dark-color);
            color: var(--dark-color);
            border-radius: 16px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
         }

         #configuracion-iframe-container .cancel-edit-btn:hover {
            background: rgba(69,88,98,0.1);
         }

         #configuracion-iframe-container .save-edit-btn {
            background: var(--dark-color);
            border: none;
            color: white;
            border-radius: 16px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
         }

         #configuracion-iframe-container .save-edit-btn:hover {
            background: #0a1f2a;
         }

         #configuracion-iframe-container .save-edit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
         }

         /* Editable table styles */
         #configuracion-iframe-container .summary-table.editing td:nth-child(2) {
            padding: 4px;
         }

         #configuracion-iframe-container .summary-table.editing .editable-field {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 15px;
            color: var(--text-color);
            font-family: inherit;
         }

         #configuracion-iframe-container .summary-table.editing .editable-field:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(4,219,141,0.15);
         }

         /* Editable profile styles */
         #configuracion-iframe-container .regulatory-summary.editing {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
         }

         #configuracion-iframe-container .regulatory-summary.editing .editable-profile {
            width: 100%;
            border: none;
            outline: none;
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-color);
            font-family: inherit;
            resize: vertical;
            height: 600px;
         }

         #configuracion-iframe-container .regulatory-summary.editing .editable-profile:focus {
            box-shadow: none;
         }

    /* --- Align contexto & agentes content same as fuentes --- */
    #configuracion-iframe-container #contexto-content,
    #configuracion-iframe-container #agentes-content {
      align-items: flex-start !important;
      text-align: left !important;
      width: 100% !important;
      max-width: 900px !important;
      margin: 0 auto !important;
    }

    /* Usage tracker styles */
    #configuracion-iframe-container .usage-tracker {
      margin-left: auto;
      font-size: 14px;
      color: var(--text-color);
      font-weight: 500;
      padding: 6px 12px;
      background: rgba(69, 88, 98, 0.1);
      border-radius: 20px;
      white-space: nowrap;
    }

    #configuracion-iframe-container .usage-tracker.unlimited {
      color: white;
      font-weight: 600;
    }

    #configuracion-iframe-container .usage-tracker.at-limit {
   
      color: #c62828;
     
    }

   /* #configuracion-iframe-container .usage-tracker.near-limit {
      background: #fff3e0;
      color: #ef6c00;
      border: 1px solid #ff9800;
    } */

    /* ✅ ESTILOS COMPLETOS PARA WARNING ICON DE EXTRACCIÓN WEB */
    #configuracion-iframe-container .web-warning-icon {
      color: #ff9800 !important; /* ✅ Color naranja visible */
      margin-left: 8px;
      font-size: 16px !important; /* ✅ Tamaño visible */
      cursor: pointer;
      transition: color 0.2s ease;
      position: relative;
      display: inline-block !important; /* ✅ Asegurar que sea visible */
      opacity: 1 !important; /* ✅ Totalmente opaco */
      visibility: visible !important; /* ✅ Totalmente visible */
    }
    
    #configuracion-iframe-container .web-warning-icon:hover {
      color: #f57c00 !important; /* ✅ Color hover más oscuro */
    }
    
    /* ✅ CREAR TOOLTIP PERSONALIZADO SIN USAR ATTR(TITLE) */
    #configuracion-iframe-container .web-warning-icon::after {
      content: "No se pudo acceder a la página web, por favor, revisa el URL compartido y prueba de nuevo";
      position: absolute;
      background: #333;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      white-space: normal;
      word-wrap: break-word;
      z-index: 1000;
      left: calc(100% + 40px);
      top: 50%;
      transform: translateY(-50%);
      width: 240px;
      min-height: 80px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      line-height: 1.4;
      pointer-events: none;
      display: flex;
      align-items: center;
      text-align: left;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
    }
    
    /* ✅ MOSTRAR TOOLTIP AL HOVER */
    #configuracion-iframe-container .web-warning-icon:hover::after {
      opacity: 1;
      visibility: visible;
    }

    /* Scoped styles for Agents UI */
    #configuracion-iframe-container .agents-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
      width: 100%;
      margin: 12px 0 24px 0;
    }
    #configuracion-iframe-container .agent-box {
      background: #fff;
      border: 2px solid #e0e0e0;
      border-radius: 14px;
      padding: 18px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    }
    #configuracion-iframe-container .agent-box:hover {
      transform: translateY(-2px);
      border-color: var(--primary-color);
      box-shadow: 0 6px 14px rgba(4,219,141,0.18);
    }
    #configuracion-iframe-container .agent-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    #configuracion-iframe-container .agent-header h3 {
      margin: 0;
      font-size: 16px;
      color: var(--dark-color);
      font-weight: 700;
      max-width: 75%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    #configuracion-iframe-container .agent-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 14px;
      background: rgba(69,88,98,0.1);
      color: var(--text-color);
      font-size: 12px;
      font-weight: 600;
    }
    #configuracion-iframe-container .agent-status i { color: #18b27d; font-size: 10px; }
    #configuracion-iframe-container .agent-objective {
      color: var(--text-color);
      font-size: 13px;
      margin: 0;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      min-height: 58px;
    }

    /* Overlay & modal */
    #configuracion-iframe-container .agent-detail-overlay {
      position: fixed;
      inset: 0;
      background: rgba(11,36,49,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 3000;
    }
    #configuracion-iframe-container .agent-modal {
      width: min(920px, 94%);
      max-height: calc(100vh - 120px);
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.25);
      overflow: hidden;
      animation: fadeInUp 0.25s ease-out;
      display: flex;
      flex-direction: column;
    }
    #configuracion-iframe-container .agent-modal.small { width: min(520px, 92%); }
    #configuracion-iframe-container .agent-modal .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      border-bottom: 1px solid #f0f0f0;
    }
    #configuracion-iframe-container #agentModalTitle {
      display: flex;
      align-items: center;
      gap: 16px;
      margin: 0;
    }
    #configuracion-iframe-container #agentModalTitle #agentTitleText {
      background: linear-gradient(90deg, var(--dark-color), var(--primary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 20px;
      font-weight: 700;
      margin-left: 4px;
    }
    #configuracion-iframe-container .edit-name-btn {
      background: rgba(69,88,98,0.1);
      border: none;
      color: var(--dark-color);
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    #configuracion-iframe-container .edit-name-btn:hover {
      background: rgba(69,88,98,0.15);
    }
    #configuracion-iframe-container .agent-modal .modal-header h2 {
      margin: 0;
      font-size: 18px;
      color: var(--dark-color);
    }
    #configuracion-iframe-container .agent-modal .close-modal {
      background: transparent;
      border: none;
      color: #999;
      font-size: 16px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    #configuracion-iframe-container .agent-modal .close-modal:hover {
      background: #f5f5f5;
      color: var(--dark-color);
    }
    #configuracion-iframe-container .agent-detail-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: flex-end;
    }
    #configuracion-iframe-container #saveAgentChangesBtn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    #configuracion-iframe-container .agent-detail-actions .generate-agent-btn,
    #configuracion-iframe-container .agent-detail-actions .cancel-edit-btn,
    #configuracion-iframe-container .agent-detail-actions .crear-agente-btn {
      border-radius: 20px !important;
    }
    #configuracion-iframe-container #saveAgentChangesBtn {
      background: #0b2431 !important;
      color: white !important;
    }
    #configuracion-iframe-container #saveAgentChangesBtn:hover {
      background: #081a24 !important;
    }
    #configuracion-iframe-container #saveAgentChangesBtn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    #configuracion-iframe-container .agent-skeleton {
      background: #f3f5f6;
      border-radius: 12px;
      height: 120px;
      animation: pulse 1.2s ease-in-out infinite;
    }
    @keyframes pulse { 0%{opacity:.6} 50%{opacity:1} 100%{opacity:.6} }
  </style>
</head>
<body>
  <div class="config-body" style="position:relative;">
    <div id="config-loader" class="loader-overlay"><div class="spinner"></div></div>
    <div class="config-body">
      <div class="config-menu">
        <div class="config-menu-item active" data-content="contexto">
          <i class="fas fa-info-circle"></i>
          <span>Contexto</span>
        </div>
        <div class="config-menu-item" data-content="fuentes">
          <i class="fas fa-database"></i>
          <span>Fuentes</span>
        </div>
        <div class="config-menu-item" data-content="agentes">
          <i class="fas fa-users"></i>
          <span>Agentes</span>
        </div>
      </div>
      
      <div id="contexto-content" class="config-content active">
        <div class="main-title"><i class="fas fa-search"></i><span>Proporciona contexto</span></div>
        <div class="content-title">Proporciona información sobre tu empresa y necesidades para personalizar tu experiencia</div>

        <!-- Onboarding form -->
        <div id="onboarding-container">
          <div id="summary-tags"></div>
          <div id="onboarding-form">
            <!-- Step 1 -->
            <section class="form-step" data-step="0">
              <div class="step-header">
                <p class="question-text">¿Qué tipo de empresa se ajusta a tu perfil?</p>
                <span class="step-tracker"></span>
              </div>
              <div class="options">
                <div class="option-box" data-value="Consultora">Consultora</div>
                <div class="option-box" data-value="Despacho">Despacho</div>
                <div class="option-box" data-value="Empresa Regulada">Empresa Regulada</div>
                <div class="option-box" data-value="Otros">Otros</div>
              </div>
            </section>
            <!-- Step 2 -->
            <section class="form-step" data-step="1">
              <div class="step-header">
                <p class="question-text">¿Cuál es tu especialización?</p>
                <span class="step-tracker"></span>
              </div>
              <div class="options">
                <div class="option-box" data-value="Energía">Energía</div>
                <div class="option-box" data-value="Construcción">Construcción</div>
                <div class="option-box" data-value="Agrícola">Agrícola</div>
                <div class="option-box" data-value="Financiero">Financiero</div>
              </div>
            </section>
          </div>
          <div id="completion-message" style="display:none;"></div>
        </div>
        <!-- End onboarding form -->
        
        <!-- Final Profile View (hidden by default) -->
        <div id="profile-summary-view" style="display: none; width: 100%; max-width: 800px; text-align: left;">
            <button id="configuraCoberturaBtn" class="configura-cobertura-btn">
                Configura tu cobertura legal <i class="fas fa-arrow-right" style="float: right;"></i>
            </button>
            <div class="context-header">
                <h3 class="summary-title">Información de empresa</h3>
                <button id="editContextBtn" class="edit-context-btn">
                    <i class="fas fa-edit"></i> Editar
                </button>
                <div id="editContextControls" class="edit-context-controls" style="display: none;">
                    <button id="cancelEditBtn" class="cancel-edit-btn">Cancelar</button>
                    <button id="saveEditBtn" class="save-edit-btn">Guardar</button>
                </div>
            </div>
            <table class="summary-table" id="contextTable">
                <tbody>
                    <!-- Rows will be injected by JS -->
                </tbody>
            </table>
            <h3 class="summary-title">Resumen perfil regulatorio</h3>
            <div id="regulatory-profile-content" class="regulatory-summary">
                <!-- Content will be injected by JS -->
            </div>
        </div>
      </div>
      
      <div id="fuentes-content" class="config-content" style="display: none; flex-direction: column; align-items: flex-start; text-align: left; width: 100%; max-width: 900px; margin: 0 auto !important;">
          <div class="main-title">
            <i class="fas fa-database"></i><span>Selecciona tus fuentes oficiales</span>
            <div id="fuentes-usage-tracker" class="usage-tracker"></div>
          </div>
          <div class="content-title">Configura tu cobertura legal seleccionando las fuentes de tu interés</div>

          <!-- Banner for users without custom agents -->
          <button id="configuraAgentesBtn" class="configura-agentes-btn" style="display: none;">
              Configura tus agentes regulatorios <i class="fas fa-arrow-right" style="float: right;"></i>
          </button>

          <div id="fuentes-container" style="width: 100%;">
              <!-- Sections will be injected here -->
          </div>
          

      </div>
      
      <div id="agentes-content" class="config-content">
        <div class="main-title">
          <i class="fas fa-users"></i><span>Configura tus agentes</span>
          <div id="agentes-usage-tracker" class="usage-tracker"></div>
        </div>
        <div class="content-title">Crea tus agentes personalizados que automáticamente analizarán toda la normativa por ti</div>
        
        <!-- Scoped styles for Agents UI -->
        <style>
          #configuracion-iframe-container .agents-grid {
             display: grid;
             grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
             gap: 20px;
             width: 100%;
             margin: 12px 0 24px 0;
           }
           #configuracion-iframe-container .agent-box {
             background: #fff;
             border: 2px solid #e0e0e0;
             border-radius: 14px;
             padding: 18px;
             cursor: pointer;
             transition: all 0.2s ease;
             box-shadow: 0 3px 10px rgba(0,0,0,0.08);
           }
          #configuracion-iframe-container .agent-box:hover {
            transform: translateY(-2px);
            border-color: var(--primary-color);
            box-shadow: 0 6px 14px rgba(4,219,141,0.18);
          }
          #configuracion-iframe-container .agent-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
          }
          #configuracion-iframe-container .agent-header h3 {
            margin: 0;
            font-size: 16px;
            color: var(--dark-color);
            font-weight: 700;
            max-width: 75%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
          }
          #configuracion-iframe-container .agent-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 14px;
            background: rgba(69,88,98,0.1);
            color: var(--text-color);
            font-size: 12px;
            font-weight: 600;
          }
          #configuracion-iframe-container .agent-status i { color: #18b27d; font-size: 10px; }
          #configuracion-iframe-container .agent-objective {
            color: var(--text-color);
            font-size: 13px;
            margin: 0;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 58px;
          }

          /* Overlay & modal */
          #configuracion-iframe-container .agent-detail-overlay {
            position: fixed;
            inset: 0;
            background: rgba(11,36,49,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
          }
                    #configuracion-iframe-container .agent-modal {
             width: min(920px, 94%);
             max-height: calc(100vh - 120px);
             background: #fff;
             border-radius: 14px;
             box-shadow: 0 16px 40px rgba(0,0,0,0.25);
             overflow: hidden;
             animation: fadeInUp 0.25s ease-out;
             display: flex;
             flex-direction: column;
           }
          #configuracion-iframe-container .agent-modal.small { width: min(520px, 92%); }
                     #configuracion-iframe-container .agent-modal .modal-header {
             display: flex;
             align-items: center;
             justify-content: space-between;
             padding: 10px 12px;
             border-bottom: 1px solid #f0f0f0;
           }
           #configuracion-iframe-container #agentModalTitle {
             display: flex;
             align-items: center;
             gap: 16px;
             margin: 0;
           }
           #configuracion-iframe-container #agentModalTitle #agentTitleText {
             background: linear-gradient(90deg, var(--dark-color), var(--primary-color));
             -webkit-background-clip: text;
             -webkit-text-fill-color: transparent;
             font-size: 20px;
             font-weight: 700;
             margin-left: 4px;
           }
           #configuracion-iframe-container .edit-name-btn {
             background: rgba(69,88,98,0.1);
             border: none;
             color: var(--dark-color);
             width: 28px;
             height: 28px;
             border-radius: 50%;
             display: inline-flex;
             align-items: center;
             justify-content: center;
             cursor: pointer;
             transition: all 0.2s ease;
           }
           #configuracion-iframe-container .edit-name-btn:hover {
             background: rgba(69,88,98,0.15);
           }
          #configuracion-iframe-container .agent-modal .modal-header h2 {
            margin: 0;
            font-size: 18px;
            color: var(--dark-color);
          }
          #configuracion-iframe-container .agent-modal .close-modal {
            background: transparent;
            border: none;
            color: #999;
            font-size: 16px;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
          }
          #configuracion-iframe-container .agent-modal .close-modal:hover {
            background: #f5f5f5;
            color: var(--dark-color);
          }
          #configuracion-iframe-container .agent-detail-actions {
             display: flex;
             align-items: center;
             gap: 10px;
             justify-content: flex-end;
           }
           #configuracion-iframe-container .agent-detail-actions .generate-agent-btn,
           #configuracion-iframe-container .agent-detail-actions .cancel-edit-btn,
           #configuracion-iframe-container .agent-detail-actions .crear-agente-btn {
             border-radius: 20px !important;
           }
           #configuracion-iframe-container #saveAgentChangesBtn {
             background: #0b2431 !important;
             color: white !important;
           }
           #configuracion-iframe-container #saveAgentChangesBtn:hover {
             background: #081a24 !important;
           }
           #configuracion-iframe-container #saveAgentChangesBtn:disabled {
             opacity: 0.6;
             cursor: not-allowed;
           }
           
           /* Contact info box styles */
           #configuracion-iframe-container .contact-info-box {
             background: #f5f5f5;
             border: 1px solid #e0e0e0;
             border-radius: 12px;
             padding: 20px;
             margin: 20px 0;
             text-align: center;
           }
           
           #configuracion-iframe-container .contact-info-box p {
             margin: 0;
             color: #666;
             font-size: 14px;
             line-height: 1.5;
           }
           
           #configuracion-iframe-container .contact-info-box a {
             color: var(--primary-color);
             text-decoration: none;
             font-weight: 600;
           }
           
           #configuracion-iframe-container .contact-info-box a:hover {
             text-decoration: underline;
           }
         </style>
        
        <!-- Agents grid -->
        <div id="agentsGrid" class="agents-grid"></div>

        <!-- Contact information box -->
        <div class="contact-info-box">
          <p>Estamos trabajando en desarrollar la funcionalidad para automatizar la creación de agentes. Mientras tanto, si quiere crear un nuevo agente póngase en contacto con el equipo de Reversa en <a href="mailto:tomas@reversa.ai">tomas@reversa.ai</a> o <a href="mailto:info@reversa.ai">info@reversa.ai</a>. ¡Gracias!</p>
        </div>

        <!-- Toast notifications -->
        <div id="agentsToast" style="position: fixed; top: 20px; right: 20px; z-index: 4000; display: none; background: #e8f5e8; color: var(--dark-color); border: 1px solid var(--primary-color); padding: 12px 16px; border-radius: 10px; box-shadow: 0 6px 16px rgba(0,0,0,0.1); font-weight: 600; font-size: 14px; min-width: 280px; align-items:center; gap:10px;"></div>

        <!-- Agent detail overlay -->
        <div id="agentDetailOverlay" class="agent-detail-overlay" style="display: none;">
          <div class="agent-modal">
            <div class="modal-header">
              <h2 id="agentModalTitle"><span id="agentTitleText">Detalle del agente</span> <button class="edit-name-btn" id="editAgentNameBtn" title="Editar nombre"><i class="fas fa-edit"></i></button></h2>
              <button class="close-modal" id="closeAgentModal"><i class="fas fa-times"></i></button>
            </div>
            <div class="product-details-form" style="margin: 0; box-shadow: none; padding-top: 10px; padding-bottom: 10px; flex: 1 1 auto; overflow: auto;">
              <div class="product-form-fields">
                
               <div class="form-field">
                   <div class="field-label-with-info">
                     <label class="field-label">Contexto</label>
                     <span class="info-icon" data-tooltip="Introduce un breve contexto sobre la actividad económica de tu empresa (sector en el que opera, tipo de clientes a los que da servicio...) que ayude al agente a personalizar el impacto normativo.">i</span>
                   </div>
                   <textarea class="product-input" id="agentContexto" rows="3" placeholder="Contexto"></textarea>
                 </div>
                 <div class="form-field">
                   <div class="field-label-with-info">
                     <label class="field-label">Objetivo</label>
                     <span class="info-icon" data-tooltip="Describe el objetivo general de este agente (ej: detectar cambios normativos relevantes en protección de datos).">i</span>
                   </div>
                   <textarea class="product-input" id="agentObjetivo" rows="3" placeholder="Objetivo"></textarea>
                 </div>
                 <div class="form-field">
                   <div class="field-label-with-info">
                     <label class="field-label">Contenido (criterios de inclusión)</label>
                     <span class="info-icon" data-tooltip="Para asegurar que el agente detecta lo relevante, detalla los supuestos en los que quieres recibir notificaciones, especificando rango normativo y efectos jurídicos.">i</span>
                   </div>
                   <textarea class="product-input" id="agentContenido" rows="8" placeholder="Contenido"></textarea>
                 </div>
                 <div class="form-field">
                   <div class="field-label-with-info">
                     <label class="field-label">Documentos no incluidos</label>
                     <span class="info-icon" data-tooltip="Para asegurar que el agente elimina el ruido, determina qué tipo de contenido no debe ser incluido.">i</span>
                   </div>
                   <textarea class="product-input" id="agentNoIncluidos" rows="8" placeholder="Documentos no incluidos"></textarea>
                 </div>
             </div>
             <div class="agent-detail-actions">
                <button id="saveAgentChangesBtn" class="generate-agent-btn" disabled><i class="fas fa-save"></i> Guardar</button>
              </div>
           </div>
         </div>
        </div>

        <!-- Unsaved changes confirmation -->
        <div id="unsavedConfirmOverlay" class="agent-detail-overlay" style="display: none;">
          <div class="agent-modal small">
            <div class="modal-header">
              <h2>¿Guardar cambios?</h2>
              <button class="close-modal" id="closeUnsavedConfirm"><i class="fas fa-times"></i></button>
            </div>
            <div class="product-details-form" style="margin: 0; box-shadow: none;">
              <p style="color: var(--text-color); margin: 0 0 16px 0;">Tienes cambios sin guardar. ¿Quieres guardarlos antes de cerrar?</p>
              <div class="agent-detail-actions">
                <button id="discardChangesBtn" class="cancel-edit-btn">Descartar</button>
                <button id="saveAndCloseBtn" class="generate-agent-btn"><i class="fas fa-save"></i> Guardar y cerrar</button>
              </div>
            </div>
          </div>
        </div>
 
        <!-- Generated agents will be dynamically inserted here -->
 <!--
        <button id="crearAgenteBtn" class="crear-agente-btn">
          <i class="fas fa-plus"></i> Crear agente
        </button>
 -->
        <!-- Agent Template Selection Box -->
        <div id="agentTemplateBox" class="agent-template-box" style="display: none;">
          <button class="close-template-box" id="closeTemplateBox">
            <i class="fas fa-times"></i>
          </button>
          <h3 class="template-title">Elige de entre nuestras plantillas pre-configuradas que tipo de agente quieres crear</h3>
          
          <div class="template-options">
            <button class="template-btn" data-type="producto">
              <div class="template-btn-content">
                <div class="template-btn-header">
                  <i class="fas fa-box"></i>
                  <span class="template-btn-title">Producto</span>
                </div>
                <p class="template-btn-description">
                  Agente especializado en identificación de novedades regulatorias que impacten un producto concreto 
                  <em>(ej: producto cárnico porcino)</em>
                </p>
              </div>
            </button>

            <button class="template-btn" data-type="cliente">
              <div class="template-btn-content">
                <div class="template-btn-header">
                  <i class="fas fa-user-tie"></i>
                  <span class="template-btn-title">Cliente</span>
                </div>
                <p class="template-btn-description">
                  Agente especializado en identificación de novedades regulatorias que impacten un cliente específico 
                  <em>(ej: empresa farmacéutica multinacional)</em>
                </p>
              </div>
            </button>

            <button class="template-btn" data-type="sector">
              <div class="template-btn-content">
                <div class="template-btn-header">
                  <i class="fas fa-industry"></i>
                  <span class="template-btn-title">Sector</span>
                </div>
                <p class="template-btn-description">
                  Agente especializado en identificación de novedades regulatorias que impacten un sector completo 
                  <em>(ej: sector energético renovable)</em>
                </p>
              </div>
            </button>

            <button class="template-btn" data-type="personalizado">
              <div class="template-btn-content">
                <div class="template-btn-header">
                  <i class="fas fa-cog"></i>
                  <span class="template-btn-title">Personalizado</span>
                </div>
                <p class="template-btn-description">
                  Define exactamente que quieres que trackee tu agente
                </p>
              </div>
            </button>
          </div>
        </div>

        <!-- Product Details Form -->
        <div id="productDetailsForm" class="product-details-form" style="display: none;">
          <button class="close-template-box" id="closeProductForm">
            <i class="fas fa-times"></i>
          </button>
          <h3 class="template-title">Proporciona algunos detalles sobre el producto</h3>
          
          <div class="product-form-fields">
            <div class="form-field">
              <label class="field-label">Nombre y descripción corta del producto</label>
              <textarea class="product-input" id="productDescription" placeholder="Ej.: &quot;Vacuna veterinaria porcina basada en ARNm&quot;" rows="3"></textarea>
            </div>

            <div class="form-field">
              <label class="field-label">Fase regulatoria o de mercado en la que se encuentra</label>
              <select class="product-select" id="productPhase">
                <option value="">Selecciona una fase</option>
                <option value="investigacion">Investigación-I+D</option>
                <option value="ensayo">Ensayo/piloto</option>
                <option value="precomercializacion">Pre-comercialización (solicitud de autorización)</option>
                <option value="comercializado">Comercializado</option>
                <option value="postcomercializacion">Post-comercialización</option>
                <option value="otro">Otro</option>
              </select>
              <div id="customPhaseContainer" class="custom-input-container" style="display: none;">
                <input type="text" class="product-input" id="customPhase" placeholder="Especifica la fase regulatoria">
              </div>
            </div>

            <div class="form-field">
              <label class="field-label">Características del producto especialmente relevantes para la regulación</label>
              <textarea class="product-input" id="productCharacteristics" placeholder="Ej.: &quot;Contiene ingredientes de origen animal&quot;, &quot;Integra IA generativa para diagnóstico&quot;, &quot;Usa nanomateriales&quot;, &quot;Alto potencial medioambiental&quot;" rows="3"></textarea>
            </div>
          </div>

          <div class="generate-agent-container">
            <button id="generateAgentBtn" class="generate-agent-btn">
              <i class="fas fa-magic"></i> Generar Agente
            </button>
          </div>
        </div>

        <!-- Client Details Form -->
        <div id="clientDetailsForm" class="product-details-form" style="display: none;">
          <button class="close-template-box" id="closeClientForm">
            <i class="fas fa-times"></i>
          </button>
          <h3 class="template-title">Proporciona algunos detalles sobre el cliente</h3>
          
          <div class="product-form-fields">
            <div class="form-field">
              <label class="field-label">Nombre y descripción del cliente</label>
              <textarea class="product-input" id="clientDescription" placeholder="Ej.: &quot;Banco digital especializado en servicios financieros para pymes&quot;" rows="3"></textarea>
            </div>

            <div class="form-field">
              <label class="field-label">Página web del cliente</label>
              <input type="url" class="product-input" id="clientWebsite" placeholder="https://www.ejemplo.com">
            </div>

            <div class="form-field">
              <label class="field-label">Sectores y áreas de interés regulatorio</label>
              <textarea class="product-input" id="clientScope" placeholder="Ej.: &quot;Servicios de pago, préstamos digitales, protección de datos financieros, blanqueo de capitales&quot;" rows="3"></textarea>
            </div>
          </div>

          <div class="generate-agent-container">
            <button id="generateClientAgentBtn" class="generate-agent-btn">
              <i class="fas fa-magic"></i> Generar Agente
            </button>
          </div>
        </div>

        <!-- Sector Details Form -->
        <div id="sectorDetailsForm" class="product-details-form" style="display: none;">
          <button class="close-template-box" id="closeSectorForm">
            <i class="fas fa-times"></i>
          </button>
          <h3 class="template-title">Proporciona algunos detalles sobre el sector</h3>
          
          <div class="product-form-fields">
            <div class="form-field">
              <label class="field-label">Defina brevemente el sector o rama jurídica que desea monitorizar</label>
              <textarea class="product-input" id="sectorDescription" placeholder="Ej.: &quot;Protección de datos&quot;" rows="3"></textarea>
            </div>

            <div class="form-field">
              <label class="field-label">Indique el ámbito geográfico o la jurisdicción principal</label>
              <input type="text" class="product-input" id="sectorGeographicScope" placeholder="Ej.: &quot;España y UE&quot;">
            </div>

            <div class="form-field">
              <label class="field-label">¿Cuál es el motivo u objetivo por el que quieres hacer este seguimiento regulatorio?</label>
              <textarea class="product-input" id="sectorSubtopics" placeholder="Ej.: &quot;Evitar sanciones por no cumplir con la normativa&quot;" rows="3"></textarea>
            </div>
          </div>

          <div class="generate-agent-container">
            <button id="generateSectorAgentBtn" class="generate-agent-btn">
              <i class="fas fa-magic"></i> Generar Agente
            </button>
          </div>
        </div>

        <!-- Custom Details Form -->
        <div id="customDetailsForm" class="product-details-form" style="display: none;">
          <button class="close-template-box" id="closeCustomForm">
            <i class="fas fa-times"></i>
          </button>
          <h3 class="template-title">Describe qué contenido quieres que el agente rastree de manera automática</h3>
          
          <div class="product-form-fields">
            <div class="form-field">
              <textarea class="product-input" id="customDescription" placeholder="Ej.: &quot;Novedades en contratación pública electrónica que afecten a pequeñas empresas de servicios tecnológicos&quot;" rows="4" style="margin-top: 10px;"></textarea>
            </div>
          </div>

          <div class="generate-agent-container">
            <button id="generateCustomAgentBtn" class="generate-agent-btn">
              <i class="fas fa-magic"></i> Generar Agente
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script src="/views/configuracion/agentes.js"></script>
  <script src="/views/configuracion/fuentes.js"></script>
  <!-- Onboarding form logic -->
  <script src="/views/configuracion/contexto.js"></script>
</body>
</html>
