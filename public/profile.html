<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile</title>
  <link rel="icon" href="assets/papyrus_logo.png" type="image/png"> 

  <!-- Font Awesome + Chart.js + Basic CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"/>
  <link href="https://fonts.googleapis.com/css?family=Heebo&display=swap" rel="stylesheet"/>

  <!-- Your existing CSS files -->
  <link rel="stylesheet" type="text/css" href="styles/styles.css" />
  <link rel="stylesheet" type="text/css" href="styles/menu.css" />
  <link rel="stylesheet" type="text/css" href="styles/toggle.css" />
  <link rel="stylesheet" type="text/css" href="styles/dropdown.css" />
  <link rel="stylesheet" type="text/css" href="styles/radio_menu.css" />
  <link rel="stylesheet" type="text/css" href="styles/mobile.css" />

  <style>
    /* Loader overlay styling */
    #pageLoaderOverlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.8);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .page-loader {
      width: 50px; height: 50px;
      border: 8px solid #f3f3f3;
      border-top: 8px solid #333;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    /* Dropdown styling for multi-check logic */
    #myDropdown,
    #ramaDropdown {
      max-height: 200px;
      overflow-y: auto;
      position: absolute;
      z-index: 1000;
      background: #fff;
      border: 1px solid #ccc;
      padding: 5px;
      display: none; /* hidden by default */
    }
    #myDropdown.show,
    #ramaDropdown.show {
      display: block;
    }
    /* Items inside the dropdown */
    #myDropdown label,
    #ramaDropdown label {
      display: block;
      padding: 4px 2px;
      margin: 0;
      cursor: pointer;
      font-size: 0.85em;
      border-bottom: 1px solid #ddd;
    }
    #myDropdown label:last-child,
    #ramaDropdown label:last-child {
      border-bottom: none;
    }
    #myDropdown input[type="checkbox"],
    #ramaDropdown input[type="checkbox"] {
      width: 16px;
      height: 16px;
      transform: scale(0.9);
      accent-color: #83a300;
      margin-right: 6px;
    }

    /* Sub-ramas container */
    #subRamasCheckboxContainer {
      margin: 10px 0;
      background: #f9f9f9;
      border: 1px solid #ccc;
      padding: 6px;
      display: none; 
      max-height: 200px;
      overflow-y: auto;
    }
    #subRamasCheckboxContainer label {
      display: block;
      margin-bottom: 5px;
      cursor: pointer;
      font-size: 0.85em;
    }
    #subRamasCheckboxContainer input[type="checkbox"] {
      width: 16px;
      height: 16px;
      transform: scale(0.9);
      accent-color: #83a300;
      margin-right: 6px;
    }

    /* Basic layout styling */
    .analytics-label { margin-top: 20px; font-weight: bold; }
    .detalle-cuenta { display: flex; gap: 50px; margin-bottom: 20px; }
    .etiquetas-label { font-weight: bold; }
    .filter-item { margin-bottom: 10px; }
    .filter-section { margin-bottom: 10px; }
    .collectionDocs { margin-top: 10px; }
    .menu.active { display: block; }

    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <!-- Loader overlay -->
  <div id="pageLoaderOverlay">
    <div class="page-loader"></div>
  </div>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo">
      <a href="https://papyrus-ai.com/" target="_blank">
        <img src="assets/papyrus_app.png" alt="Papyrus Logo">
      </a>
    </div>
    <button class="hamburger" onclick="toggleMenu()">☰</button>
    <ul class="menu">
      <li><a href="https://papyrus-ai.com/">WEB</a></li>
      <li><a href="/profile">PANEL DE CONTROL</a></li>
      <li><a href="http://app.papyrus-ai.com/suscripcion.html">EDITAR SUSCRIPCIÓN</a></li>
      <li><a href="https://papyrus-ai.com/pages/contact-1">AYUDA</a></li>
    </ul>
  </nav>

  <h1>Hola {{name}}</h1>

  <div id="data-container">
    <!-- 1) Show user-subscribed Industries / Ramas in etiquetass-values -->
    <div class="detalle-cuenta">
      <div>
        <div class="etiquetas-label">Sectores Económicos Suscritos</div>
        <div class="etiquetas-values" id="etiquetasContainer"></div> <!-- Populated below -->
      </div>
      <div>
        <div class="etiquetas-label">Ramas Jurídicas Suscritas</div>
        <div class="etiquetas-values" id="ramasContainer"></div> <!-- Populated below -->
      </div>
    </div>

    <a href="#" id="editIndustriesLink" class="change-subscription">Editar Suscripción</a>
    <div class="analytics-label busqueda">Búsqueda Avanzada</div>

    <!-- JSON data for industries, ramas, subramas, etc. -->
    <script id="industryTags" type="application/json">{{industry_tags_json}}</script>
    <script id="ramaJuridicas" type="application/json">{{rama_juridicas_json}}</script>
    <script id="userSubRamaMap" type="application/json">
      {
        "Derecho Civil":["genérico","familia","sucesiones"],
        "Derecho Administrativo":["genérico","urbanismo","contratación pública"]
      }
    </script>

    <!-- Filter Section -->
    <div id="Filtrar">
      <!-- Sector Económico multi-check -->
      <div class="filter-item">
        <div class="etiquetas-label">Sector Económico</div>
        <div class="dropdown">
          <button onclick="toggleIndustryDropdown()" class="dropbtn">
            <span id="selectedIndustry">Todas</span>
            <i class="fa fa-caret-down"></i>
          </button>
          <div id="myDropdown" class="dropdown-content">
            <!-- Populated by populateIndustryDropdown(), default: all checked -->
          </div>
        </div>
      </div>

      <!-- Rama Jurídica multi-check + sub-ramas -->
      <div class="filter-item">
        <div class="etiquetas-label">Rama Jurídica</div>
        <div class="dropdown" style="margin-bottom: 10px;">
          <button onclick="toggleRamaDropdown()" class="dropbtn">
            <span id="selectedRama">Todas</span>
            <i class="fa fa-caret-down"></i>
          </button>
          <div id="ramaDropdown" class="dropdown-content">
            <!-- Populated by populateRamaDropdown(), default: all checked -->
          </div>
        </div>
        <!-- sub-ramas container if a single rama is chosen -->
        <div id="subRamasCheckboxContainer"></div>
      </div>

      <!-- Boletín Oficial checkboxes -->
      <div class="filter-item">
        <div class="filter-section">
          <div class="etiquetas-label">Boletín Oficial</div>
          <div class="filter-options">
            <label class="filter-option"><input type="checkbox" name="boletin" value="BOE" checked> BOE</label>
            <label class="filter-option"><input type="checkbox" name="boletin" value="BOCM"> BOCM</label>
            <label class="filter-option"><input type="checkbox" name="boletin" value="BOA"> BOA</label>
            <label class="filter-option"><input type="checkbox" name="boletin" value="BOJA"> BOJA</label>
            <label class="filter-option"><input type="checkbox" name="boletin" value="BOPV"> BOPV</label>
            <label class="filter-option"><input type="checkbox" name="boletin" value="DOUE"> DOUE</label>
          </div>
        </div>
      </div>

      <!-- Date filters -->
      <div class="filter-item">
        <div class="etiquetas-label">Fecha de publicación</div>
        <div class="date-filter">
          <label for="startDate">Desde:</label>
          <input type="date" id="startDate" name="startDate" />
          <label for="endDate">Hasta:</label>
          <input type="date" id="endDate" name="endDate" />
        </div>
      </div>
    </div>

    <div style="text-align: right;">
      <button id="buscarBtn" onclick="handleBuscar()">Buscar</button>
    </div>

    <div class="analytics-label">Estadísticas de la búsqueda</div>
    <div id="loading-icon-chart" style="display: none;">
      <div class="loader"></div>
    </div>
    <div id="chartContainer">
      <canvas id="documentsChart"></canvas>
    </div>

    <div class="analytics-label">Documentos</div>
    <div id="loading-icon" style="display: none;">
      <div class="loader"></div>
    </div>
    <div class="collectionDocs">{{boeDocuments}}</div>
  </div>

  <div class="logout-container">
    <a href="/logout">Logout</a>
  </div>

  <!-- Additional JSON data for the chart and plan, etc. -->
  <script id="monthsData" type="application/json">{{months_json}}</script>
  <script id="countsData" type="application/json">{{counts_json}}</script>
  <script id="userPlan" type="application/json">{{subscription_plan}}</script>
  <script id="startDateInput" type="application/json">{{start_date}}</script>
  <script id="endDateInput" type="application/json">{{end_date}}</script>

  <script>
    // ----------------------- NAV/HAMBURGER -----------------------
    function toggleMenu() {
      const menu = document.querySelector('.menu');
      menu.classList.toggle('active');
    }
    document.addEventListener('click', function(event) {
      const menu = document.querySelector('.menu');
      const hamburger = document.querySelector('.hamburger');
      if (!menu.contains(event.target) && !hamburger.contains(event.target)) {
        menu.classList.remove('active');
      }
    });

    // ----------------------- GLOBAL LOADER / PAGE LOAD -----------------------
    document.addEventListener("DOMContentLoaded", () => {
      // Hide initial loader
      const loaderOverlay = document.getElementById("pageLoaderOverlay");
      if (loaderOverlay) loaderOverlay.style.display = "none";

      // Fill default date from server
      const startDateInput = JSON.parse(document.getElementById("startDateInput").textContent || '"2024-01-01T00:00:00.000Z"');
      const formattedDate = new Date(startDateInput).toISOString().split('T')[0];
      const startDate = document.getElementById("startDate");
      if (formattedDate && startDate) {
        startDate.value = formattedDate;
      }

      // If we have months / counts => load chart on first page load
      const monthsData = JSON.parse(document.getElementById('monthsData').textContent || '[]');
      const countsData = JSON.parse(document.getElementById('countsData').textContent || '[]');
      if (monthsData.length && countsData.length) {
        loadChart(monthsData, countsData);
      }
    });

    // Edit subscription link
    document.getElementById('editIndustriesLink').addEventListener('click', function(e){
      e.preventDefault();
      window.location.href = '/suscripcion.html';
    });

    // Plan1 logic => disable boe
    document.addEventListener("DOMContentLoaded", () => {
      const userPlan = JSON.parse(document.getElementById("userPlan").textContent || '"plan1"');
      const boletinCheckboxes = document.querySelectorAll('.filter-options input[type="checkbox"]');
      let banner;
      if (userPlan === 'plan1') {
        boletinCheckboxes.forEach((checkbox) => {
          if (checkbox.value !== 'BOE') {
            checkbox.disabled = true;
            checkbox.parentElement.style.opacity = '0.5';
            const showBanner = () => {
              if (!banner) {
                banner = document.createElement("div");
                banner.textContent = "Mejora tu suscripción para acceder a otros Boletines Oficiales";
                banner.style.cssText = `
                  position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
                  background: #ffc107; color: #000; padding: 10px 20px; border-radius: 5px;
                  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); z-index: 1000; text-align: center;
                `;
                const closeButton = document.createElement("span");
                closeButton.textContent = " ×";
                closeButton.style.cssText = `margin-left: 10px; cursor: pointer; font-weight: bold;`;
                closeButton.onclick = () => {
                  if (banner) {
                    banner.remove();
                    banner = null;
                  }
                };
                banner.appendChild(closeButton);
                document.body.appendChild(banner);
                setTimeout(() => {
                  if (banner) {
                    banner.remove();
                    banner = null;
                  }
                }, 1500);
              }
            };
            checkbox.parentElement.addEventListener('mouseover', (e) => {
              e.preventDefault();
              showBanner();
            });
            checkbox.parentElement.addEventListener('click', (e) => {
              e.preventDefault();
              showBanner();
            });
          }
        });
      }
    });

    // ----------------------- FILL user data in #etiquetasContainer / #ramasContainer -----------------------
    let userIndustries = [];
    let userRamas = [];
    let userSubRamaMap = {};

    (function initUserData(){
      // parse user industries
      const industryTagScript = document.getElementById('industryTags');
      if (industryTagScript) {
        userIndustries = JSON.parse(industryTagScript.textContent) || [];
      }
      // parse user Ramas
      const ramaScript = document.getElementById('ramaJuridicas');
      if (ramaScript) {
        userRamas = JSON.parse(ramaScript.textContent) || [];
      }
      // parse userSubRamaMap
      const subRamaScript = document.getElementById('userSubRamaMap');
      if (subRamaScript) {
        userSubRamaMap = JSON.parse(subRamaScript.textContent) || {};
      }

      // 1) Show them in #etiquetasContainer
      const etcContainer = document.getElementById('etiquetasContainer');
      if (etcContainer) {
        if (userIndustries.length > 0) {
          etcContainer.innerHTML = userIndustries.map(i => `<span>${i}</span>`).join('');
        } else {
          etcContainer.innerHTML = `<span>No hay sectores suscritos</span>`;
        }
      }
      // 2) Show them in #ramasContainer
      const ramaContainer = document.getElementById('ramasContainer');
      if (ramaContainer) {
        if (userRamas.length > 0) {
          ramaContainer.innerHTML = userRamas.map(r => `<span>${r}</span>`).join('');
        } else {
          ramaContainer.innerHTML = `<span>No hay ramas suscritas</span>`;
        }
      }
    })();

    // ----------------------- MULTI-CHECK logic for "Sector Económico" -----------------------
    function toggleIndustryDropdown() {
      const dd = document.getElementById('myDropdown');
      dd.classList.toggle('show');
    }
    function populateIndustryDropdown() {
      const container = document.getElementById('myDropdown');
      if (!container) return;
      container.innerHTML = '';

      // "Todos" => checked
      const labelTodos = document.createElement('label');
      labelTodos.innerHTML = `
        <input type="checkbox" id="chkAllIndustry" value="Todos" checked> Todos
      `;
      container.appendChild(labelTodos);

      // userIndustries => each checked
      userIndustries.forEach(ind => {
        const lbl = document.createElement('label');
        lbl.innerHTML = `<input type="checkbox" value="${ind}" checked> ${ind}`;
        container.appendChild(lbl);
      });

      // event listeners to handle toggles
      // 1) if #chkAllIndustry changed => toggle all
      const chkAllIndustry = labelTodos.querySelector('#chkAllIndustry');
      chkAllIndustry.addEventListener('change', () => {
        const others = container.querySelectorAll('input[type="checkbox"]:not(#chkAllIndustry)');
        if (chkAllIndustry.checked) {
          others.forEach(o => o.checked = true);
        } else {
          others.forEach(o => o.checked = false);
        }
        updateIndustryLabel();
      });
      // 2) if user toggles any item => check if all or none
      const otherBoxes = container.querySelectorAll('input[type="checkbox"]:not(#chkAllIndustry)');
      otherBoxes.forEach(box => {
        box.addEventListener('change', () => {
          const allChecked = [...otherBoxes].every(b => b.checked);
          chkAllIndustry.checked = allChecked;
          updateIndustryLabel();
        });
      });

      // set the label => "Todas"
      document.getElementById('selectedIndustry').textContent = 'Todas';
    }
    function updateIndustryLabel() {
      const container = document.getElementById('myDropdown');
      const chkAllIndustry = container.querySelector('#chkAllIndustry');
      const otherBoxes = container.querySelectorAll('input[type="checkbox"]:not(#chkAllIndustry)');
      const labelSpan = document.getElementById('selectedIndustry');

      if (chkAllIndustry.checked) {
        labelSpan.textContent = 'Todas';
        return;
      }
      // count how many are checked
      let checkedCount = 0;
      let singleValue = '';
      otherBoxes.forEach(b => {
        if (b.checked) {
          checkedCount++;
          singleValue = b.value;
        }
      });
      if (checkedCount === 0) {
        labelSpan.textContent = 'Ninguno';
      } else if (checkedCount === 1) {
        labelSpan.textContent = singleValue;
      } else if (checkedCount === otherBoxes.length) {
        labelSpan.textContent = 'Todas';
        chkAllIndustry.checked = true;
      } else {
        labelSpan.textContent = checkedCount + ' seleccionados';
      }
    }

    // ----------------------- MULTI-CHECK logic for "Rama Jurídica" -----------------------
    function toggleRamaDropdown() {
      const dd = document.getElementById('ramaDropdown');
      dd.classList.toggle('show');
    }
    function populateRamaDropdown() {
      const container = document.getElementById('ramaDropdown');
      if (!container) return;
      container.innerHTML = '';

      // "Todos" => checked
      const lblTodos = document.createElement('label');
      lblTodos.innerHTML = `
        <input type="checkbox" id="chkAllRamas" value="Todos" checked> Todos
      `;
      container.appendChild(lblTodos);

      // userRamas => each checked
      userRamas.forEach(r => {
        const lbl = document.createElement('label');
        lbl.innerHTML = `<input type="checkbox" value="${r}" checked> ${r}`;
        container.appendChild(lbl);
      });

      // event listeners
      const chkAllRamas = lblTodos.querySelector('#chkAllRamas');
      chkAllRamas.addEventListener('change', () => {
        const others = container.querySelectorAll('input[type="checkbox"]:not(#chkAllRamas)');
        if (chkAllRamas.checked) {
          others.forEach(o => o.checked = true);
        } else {
          others.forEach(o => o.checked = false);
        }
        updateRamaLabel();
      });

      const otherRamas = container.querySelectorAll('input[type="checkbox"]:not(#chkAllRamas)');
      otherRamas.forEach(box => {
        box.addEventListener('change', () => {
          const allChecked = [...otherRamas].every(b => b.checked);
          chkAllRamas.checked = allChecked;
          updateRamaLabel();
        });
      });

      document.getElementById('selectedRama').textContent = 'Todas';
      document.getElementById('subRamasCheckboxContainer').style.display = 'none';
    }
    function updateRamaLabel() {
      const container = document.getElementById('ramaDropdown');
      const chkAllRamas = container.querySelector('#chkAllRamas');
      const otherRamas = container.querySelectorAll('input[type="checkbox"]:not(#chkAllRamas)');
      const labelSpan = document.getElementById('selectedRama');

      if (chkAllRamas.checked) {
        labelSpan.textContent = 'Todas';
        document.getElementById('subRamasCheckboxContainer').style.display = 'none';
        return;
      }
      let checkedCount = 0;
      let singleValue = '';
      otherRamas.forEach(b => {
        if (b.checked) {
          checkedCount++;
          singleValue = b.value;
        }
      });
      if (checkedCount === 0) {
        labelSpan.textContent = 'Ninguno';
        document.getElementById('subRamasCheckboxContainer').style.display = 'none';
      } else if (checkedCount === 1) {
        labelSpan.textContent = singleValue;
        // Potentially show sub-ramas for that one
        fillSubRamas(singleValue);
      } else if (checkedCount === otherRamas.length) {
        labelSpan.textContent = 'Todas';
        chkAllRamas.checked = true;
        document.getElementById('subRamasCheckboxContainer').style.display = 'none';
      } else {
        labelSpan.textContent = checkedCount + ' seleccionados';
        document.getElementById('subRamasCheckboxContainer').style.display = 'none';
      }
    }
    function fillSubRamas(ramaName) {
      const container = document.getElementById('subRamasCheckboxContainer');
      container.innerHTML = '';
      if (!userSubRamaMap[ramaName] || userSubRamaMap[ramaName].length === 0) {
        container.style.display = 'none';
        return;
      }
      container.style.display = 'block';
      userSubRamaMap[ramaName].forEach(sub => {
        const lbl = document.createElement('label');
        lbl.innerHTML = `<input type="checkbox" value="${sub}" checked> ${sub}`;
        container.appendChild(lbl);
      });
    }

    // If user clicks outside the dropdown => hide
    document.addEventListener('click', function(e) {
      const isIndustryDrop = e.target.closest('#myDropdown') || e.target.closest('#selectedIndustry');
      if (!isIndustryDrop) {
        document.getElementById('myDropdown').classList.remove('show');
      }
      const isRamaDrop = e.target.closest('#ramaDropdown') || e.target.closest('#selectedRama');
      if (!isRamaDrop) {
        document.getElementById('ramaDropdown').classList.remove('show');
      }
    });

    // ----------------------- SERVER FETCH ON handleBuscar() -----------------------
    async function handleBuscar() {
      // 1) Boletines
      const checked = document.querySelectorAll('input[name="boletin"]:checked');
      let selectedCollections = Array.from(checked).map(ch => ch.value);
      if (selectedCollections.length === 0) selectedCollections = ['BOE'];

      // 2) Industry
      const containerInd = document.getElementById('myDropdown');
      const chkAllIndustry = containerInd.querySelector('#chkAllIndustry');
      const otherInds = containerInd.querySelectorAll('input[type="checkbox"]:not(#chkAllIndustry)');
      let selectedIndustries = [];
      if (chkAllIndustry.checked) {
        // user wants "Todas"
      } else {
        otherInds.forEach(cb => {
          if (cb.checked) selectedIndustries.push(cb.value);
        });
      }

      // 3) Rama
      const containerRama = document.getElementById('ramaDropdown');
      const chkAllRamas = containerRama.querySelector('#chkAllRamas');
      const otherRamas = containerRama.querySelectorAll('input[type="checkbox"]:not(#chkAllRamas)');
      let selectedRamas = [];
      if (chkAllRamas.checked) {
        // "Todas"
      } else {
        otherRamas.forEach(cb => {
          if (cb.checked) selectedRamas.push(cb.value);
        });
      }

      // subRamas if exactly one
      let selectedSubRamas = [];
      if (!chkAllRamas.checked && selectedRamas.length === 1) {
        const subBoxes = document.querySelectorAll('#subRamasCheckboxContainer input[type="checkbox"]');
        subBoxes.forEach(sb => {
          if (sb.checked) selectedSubRamas.push(sb.value);
        });
      }

      // 4) date range
      const desde = document.getElementById('startDate').value;
      const hasta = document.getElementById('endDate').value;

      // 5) Build query
      let parts = [];
      selectedCollections.forEach(c => parts.push(`collections[]=${encodeURIComponent(c)}`));

      if (chkAllIndustry.checked) {
        parts.push(`industry=Todas`);
      } else if (selectedIndustries.length === 0) {
        parts.push(`industry=__none`);
      } else {
        parts.push(`industry=${encodeURIComponent(selectedIndustries.join('||'))}`);
      }

      if (chkAllRamas.checked) {
        parts.push(`rama=Todas`);
      } else if (selectedRamas.length === 0) {
        parts.push(`rama=__none`);
      } else {
        parts.push(`rama=${encodeURIComponent(selectedRamas.join('||'))}`);
      }

      if (selectedSubRamas.length > 0) {
        parts.push(`subRamas=${encodeURIComponent(selectedSubRamas.join(','))}`);
      }

      if (desde) parts.push(`desde=${encodeURIComponent(desde)}`);
      if (hasta) parts.push(`hasta=${encodeURIComponent(hasta)}`);

      const finalQuery = parts.join('&');
      const url = `/data?${finalQuery}`;

      // Show loaders
      document.getElementById('chartContainer').style.display = 'none';
      document.getElementById('loading-icon-chart').style.display = 'block';
      document.getElementById('loading-icon').style.display = 'block';

      try {
        const resp = await fetch(url);
        if (!resp.ok) throw new Error('Network error fetching data');
        const data = await resp.json();
        document.querySelector('.collectionDocs').innerHTML = data.documentsHtml || '';
        if (data.months && data.counts) {
          loadChart(data.months, data.counts);
        }
      } catch(err) {
        console.error('Error searching data:', err);
      } finally {
        document.getElementById('loading-icon').style.display = 'none';
        document.getElementById('loading-icon-chart').style.display = 'none';
        document.getElementById('chartContainer').style.display = 'block';
      }
    }

    // ----------------------- CHART LOAD -----------------------
    let myChart;
    function loadChart(months, counts) {
      const ctx = document.getElementById('documentsChart').getContext('2d');
      if (myChart) {
        myChart.destroy();
      }
      myChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: months,
          datasets: [{
            label: 'Documentos',
            data: counts,
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    // ----------------------- ON PAGE LOAD: populate dropdowns & sub data -----------
    document.addEventListener('DOMContentLoaded', () => {
      populateIndustryDropdown();
      populateRamaDropdown();

      // If userRamas or userIndustries => fill them in the container. (Done above in initUserData)
    });
  </script>
</body>
</html>
